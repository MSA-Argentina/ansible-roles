---
  #TODO: the script has hardcoded values. Create a module to abstract this functionality.
  - name: bootstrap | Changing sources to Ubuntu local mirror
    script: configure_sources.sh
    when: bootstrap_local_sources and ansible_distribution == 'Ubuntu'

  - name: bootstrap | Upgrade system (Ubuntu)
    apt:
      upgrade=dist
    when: bootstrap_upgrade_system and ansible_distribution == 'Ubuntu'

  - name: Add EPEL repository
    yum:
      name=epel-release
      state=present
    when: ansible_distribution == 'Amazon'

  - name: bootstrap | Installing essential packages to build and run software
    apt:
      pkg={{item}}
      state=latest
      update_cache=yes
    with_items:
      - build-essential
      - bzip2
      - curl
      - libssl-dev
      - locales
      - ntp
      - openssl
      - python-software-properties
      - ssl-cert
      - wget
    when: ansible_distribution == 'Ubuntu'

  - name: Install the 'Development tools' package group
    yum:
      name="@Development tools"
      state=present
    when: ansible_distribution == 'Amazon'

  - name: bootstrap | Installing useful packages for development in the server
    apt:
      pkg={{item}}
      state=latest
      update_cache=yes
    with_items:
      - git
      - htop
      - silversearcher-ag
      - vim
      - tree
      - multitail
      - unzip
    when: bootstrap_install_dev_packages and ansible_distribution == 'Ubuntu'

  - name: bootstrap | Installing useful packages for development in the server
    yum:
      name={{item}}
      state=latest
      update_cache=yes
    with_items:
      - git
      - htop
      - vim
      - tree
      - multitail
      - wget
      - unzip
    when: bootstrap_install_dev_packages and ansible_distribution == 'Amazon'

  # - name: Install The Silver Searcher
  #   yum:
  #     name=http://download.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
  #     state=present
  #   when: ansible_distribution == 'CentOS'

  - name: bootstrap | Adding nagios plugin
    apt:
      pkg=nagios-plugins
      state=latest
      update_cache=yes
      install_recommends=no
    when: bootstrap_nagios

  - name: bootstrap | Adding mosh PPA
    apt_repository:
      repo="ppa:keithw/mosh"
      update_cache=yes
    when: bootstrap_install_mosh and ansible_distribution == 'Ubuntu'

  - name: bootstrap | Installing mosh
    apt:
      pkg=mosh
      state=latest
      update_cache=yes
      install_recommends=no
    when: bootstrap_install_mosh and ansible_distribution == 'Ubuntu'

  - name: bootstrap | Enabling port(s) for mosh in ufw
    ufw:
      rule=allow
      port="60000:61000"
      proto=udp
    when: bootstrap_install_mosh and ansible_distribution == 'Ubuntu'
